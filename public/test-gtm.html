<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç GTM - Lehko Track</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { color: blue; }
        pre {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background: #0d9488;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0f766e;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç GTM - Lehko Track</h1>
    
    <div class="test-box">
        <h2>1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç–∞</h2>
        <div id="scriptCheck">
            <p class="info">–ü–µ—Ä–µ–≤—ñ—Ä—è—é...</p>
        </div>
    </div>
    
    <div class="test-box">
        <h2>2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Network –∑–∞–ø–∏—Ç—ñ–≤</h2>
        <p>–í—ñ–¥–∫—Ä–∏–π—Ç–µ F12 ‚Üí Network ‚Üí –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Å—Ç–æ—Ä—ñ–Ω–∫—É</p>
        <p>–®—É–∫–∞–π—Ç–µ –∑–∞–ø–∏—Ç–∏ –¥–æ:</p>
        <ul>
            <li><code>pixel.js</code> - –º–∞—î –±—É—Ç–∏ —Å—Ç–∞—Ç—É—Å 200</li>
            <li><code>/api/track/verify</code> - –º–∞—î –±—É—Ç–∏ —Å—Ç–∞—Ç—É—Å 200</li>
        </ul>
    </div>
    
    <div class="test-box">
        <h2>3. –ö–æ–¥ –¥–ª—è GTM</h2>
        <p>–°–∫–æ–ø—ñ—é–π—Ç–µ —Ü–µ–π –∫–æ–¥ –≤ GTM Custom HTML —Ç–µ–≥:</p>
        <pre id="gtmCode"></pre>
        <button onclick="copyCode()">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –∫–æ–¥</button>
    </div>
    
    <div class="test-box">
        <h2>4. –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h2>
        <button onclick="checkTracker()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ç—Ä–µ–∫–µ—Ä</button>
        <button onclick="testVerify()">–¢–µ—Å—Ç Verification Ping</button>
        <div id="diagnostics"></div>
    </div>

    <script>
        // Generate GTM code
        const siteId = new URLSearchParams(window.location.search).get('id') || 'YOUR_SITE_ID';
        // Use current origin for API URL (works for localhost or production)
        const apiUrl = window.location.origin.includes('localhost') 
            ? window.location.origin 
            : 'https://lehko.space';
        const gtmCode = `<script>
(function() {
  var script = document.createElement('script');
  script.src = '${apiUrl}/pixel.js?id=${siteId}';
  script.async = true;
  (document.head || document.getElementsByTagName('head')[0]).appendChild(script);
})();
</script>`;
        
        document.getElementById('gtmCode').textContent = gtmCode;
        
        // Show API URL info
        const apiInfo = document.createElement('div');
        apiInfo.className = 'test-box';
        apiInfo.innerHTML = `
            <h2>‚ÑπÔ∏è –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ API URL</h2>
            <p><strong>–ü–æ—Ç–æ—á–Ω–∏–π API URL:</strong> <code>${apiUrl}</code></p>
            <p class="info">–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø–æ—Ç–æ—á–Ω–∏–π origin.</p>
            <p class="info">–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ: <code>https://lehko.space</code></p>
        `;
        document.body.insertBefore(apiInfo, document.body.firstChild.nextSibling);
        
        function copyCode() {
            navigator.clipboard.writeText(gtmCode);
            alert('–ö–æ–¥ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!');
        }
        
        function checkTracker() {
            const div = document.getElementById('diagnostics');
            let html = '<h3>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏:</h3><ul>';
            
            // Check if tracker loaded
            if (typeof window.LehkoTrack !== 'undefined') {
                html += '<li class="success">‚úÖ –¢—Ä–µ–∫–µ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ (window.LehkoTrack —ñ—Å–Ω—É—î)</li>';
                try {
                    const siteId = window.LehkoTrack.getSiteId ? window.LehkoTrack.getSiteId() : 'N/A';
                    const baseUrl = window.LehkoTrack.getBaseUrl ? window.LehkoTrack.getBaseUrl() : 'N/A';
                    html += `<li class="info">Site ID: ${siteId}</li>`;
                    html += `<li class="info">Base URL: ${baseUrl}</li>`;
                } catch(e) {
                    html += `<li class="error">–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ: ${e.message}</li>`;
                }
            } else {
                html += '<li class="error">‚ùå –¢—Ä–µ–∫–µ—Ä –ù–ï –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ (window.LehkoTrack –Ω–µ —ñ—Å–Ω—É—î)</li>';
            }
            
            // Check script tags
            const scripts = document.getElementsByTagName('script');
            let foundPixel = false;
            for (let script of scripts) {
                if (script.src && script.src.includes('pixel.js')) {
                    foundPixel = true;
                    html += `<li class="success">‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ script —Ç–µ–≥: ${script.src}</li>`;
                }
            }
            if (!foundPixel) {
                html += '<li class="error">‚ùå –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ script —Ç–µ–≥ –∑ pixel.js</li>';
            }
            
            html += '</ul>';
            div.innerHTML = html;
        }
        
        function testVerify() {
            const div = document.getElementById('diagnostics');
            div.innerHTML += '<p class="info">–í—ñ–¥–ø—Ä–∞–≤–ª—è—é verification ping...</p>';
            
            const siteId = new URLSearchParams(window.location.search).get('id') || '6';
            const domain = window.location.hostname;
            // Use current origin for API URL
            const apiUrl = window.location.origin.includes('localhost') 
                ? window.location.origin 
                : 'https://lehko.space';
            const url = `${apiUrl}/api/track/verify?domain=${encodeURIComponent(domain)}&site_id=${siteId}&version=test&timestamp=${Date.now()}`;
            
            fetch(url, { method: 'GET', keepalive: true })
                .then(res => res.json())
                .then(data => {
                    div.innerHTML += `<p class="success">‚úÖ Verification ping —É—Å–ø—ñ—à–Ω–∏–π!</p><pre>${JSON.stringify(data, null, 2)}</pre>`;
                })
                .catch(err => {
                    div.innerHTML += `<p class="error">‚ùå –ü–æ–º–∏–ª–∫–∞: ${err.message}</p><p class="info">–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω–æ —Ç–∞ –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑–∞ URL: ${apiUrl}</p>`;
                });
        }
        
        // Auto-check on load
        setTimeout(() => {
            checkTracker();
            const scriptCheck = document.getElementById('scriptCheck');
            if (typeof window.LehkoTrack !== 'undefined') {
                scriptCheck.innerHTML = '<p class="success">‚úÖ –°–∫—Ä–∏–ø—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!</p>';
            } else {
                scriptCheck.innerHTML = '<p class="error">‚ùå –°–∫—Ä–∏–ø—Ç –ù–ï –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ Console (F12) –Ω–∞ –ø–æ–º–∏–ª–∫–∏.</p>';
            }
        }, 2000);
    </script>
    
    <!-- Test: Load script programmatically (like GTM does) -->
    <script>
        (function() {
            // Use current origin for API URL (works for localhost or production)
            const apiUrl = window.location.origin.includes('localhost') 
                ? window.location.origin 
                : 'https://lehko.space';
            var script = document.createElement('script');
            script.src = apiUrl + '/pixel.js?id=' + (new URLSearchParams(window.location.search).get('id') || '6');
            script.async = true;
            (document.head || document.getElementsByTagName('head')[0]).appendChild(script);
        })();
    </script>
</body>
</html>
