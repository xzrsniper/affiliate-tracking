# üöÄ Affiliate Tracker v2.0 - –°–ø—Ä–æ—â–µ–Ω–∞ —Ç–∞ –Ω–∞–¥—ñ–π–Ω–∞ –≤–µ—Ä—Å—ñ—è

## –©–æ –∑–º—ñ–Ω–∏–ª–æ—Å—è

### –ü—Ä–æ–±–ª–µ–º–∏ —Å—Ç–∞—Ä–æ–≥–æ —Ç—Ä–µ–∫–µ—Ä–∞:
- ‚ùå –ó–∞–Ω–∞–¥—Ç–æ —Å–∫–ª–∞–¥–Ω–∏–π (1500+ —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É)
- ‚ùå –ù–∞–¥–º—ñ—Ä–Ω–æ —Å—Ç—Ä–æ–≥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è –∫–æ–Ω–≤–µ—Ä—Å—ñ–π (–ø—Ä–æ–ø—É—Å–∫–∞—î —Ä–µ–∞–ª—å–Ω—ñ)
- ‚ùå –°–∫–ª–∞–¥–Ω–∞ –ª–æ–≥—ñ–∫–∞ –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç–∞–º
- ‚ùå –ü—Ä–æ–±–ª–µ–º–∏ –∑ cookies/localStorage –Ω–∞ —Ä—ñ–∑–Ω–∏—Ö –¥–æ–º–µ–Ω–∞—Ö
- ‚ùå CORS –ø—Ä–æ–±–ª–µ–º–∏

### –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Ç—Ä–µ–∫–µ—Ä–∞:
- ‚úÖ **–°–ø—Ä–æ—â–µ–Ω–∏–π –∫–æ–¥** - 400 —Ä—è–¥–∫—ñ–≤ –∑–∞–º—ñ—Å—Ç—å 1500
- ‚úÖ **–ù–∞–¥—ñ–π–Ω—ñ—à–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è** - –∫—Ä–∞—â–∞ —Ä–æ–±–æ—Ç–∞ –∑ cookies —Ç–∞ localStorage
- ‚úÖ **–ü—Ä–æ—Å—Ç—ñ—à–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è** - –º–µ–Ω—à–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏, –±—ñ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—é
- ‚úÖ **–ö—Ä–∞—â–∏–π pixel tracking** - –Ω–∞–¥—ñ–π–Ω—ñ—à–∏–π fallback
- ‚úÖ **–ö—Ä–∞—â–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫** - –Ω–µ –ª–∞–º–∞—î —Å–∞–π—Ç –∫–ª—ñ—î–Ω—Ç–∞

---

## –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –ü—Ä—è–º–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

–î–æ–¥–∞–π—Ç–µ –≤ `<head>` –≤–∞—à–æ–≥–æ —Å–∞–π—Ç—É:

```html
<script>
  window.TRACKER_CONFIG = {
    BASE_URL: 'https://lehko.space/api/track',
    DEBUG: false  // –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å true –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
  };
</script>
<script src="https://lehko.space/tracker-v2.js" async></script>
```

### –í–∞—Ä—ñ–∞–Ω—Ç 2: Google Tag Manager

1. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π —Ç–µ–≥ —Ç–∏–ø—É "Custom HTML"
2. –î–æ–¥–∞–π—Ç–µ –∫–æ–¥:

```html
<script>
  window.TRACKER_CONFIG = {
    BASE_URL: 'https://lehko.space/api/track',
    DEBUG: false
  };
</script>
<script src="https://lehko.space/tracker-v2.js" async></script>
```

3. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ —Ç—Ä–∏–≥–µ—Ä: "All Pages"
4. –ó–±–µ—Ä–µ–∂—ñ—Ç—å —Ç–∞ –æ–ø—É–±–ª—ñ–∫—É–π—Ç–µ

---

## –Ø–∫ –ø—Ä–∞—Ü—é—î —Ç—Ä–µ–∫–µ—Ä

### 1. –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∫–ª—ñ–∫—ñ–≤

–¢—Ä–µ–∫–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥—Å—Ç–µ–∂—É—î –∫–ª—ñ–∫–∏, –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –ø–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—é –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `?ref=CODE`.

**–ü—Ä–∏–∫–ª–∞–¥:**
```
https://example.com/product?ref=ABC123
```

–¢—Ä–µ–∫–µ—Ä –∑–±–µ—Ä—ñ–≥–∞—î –∫–æ–¥ `ABC123` –≤ cookies —Ç–∞ localStorage —ñ –≤—ñ–¥—Å—Ç–µ–∂—É—î –≤—Å—ñ –ø–æ–¥–∞–ª—å—à—ñ –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

### 2. –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∫–æ–Ω–≤–µ—Ä—Å—ñ–π

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è (—Ä–æ–∑—É–º–Ω–µ)

–¢—Ä–µ–∫–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏—è–≤–ª—è—î –∫–æ–Ω–≤–µ—Ä—Å—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å–∏—Å—Ç–µ–º—É –æ—á–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∫—ñ–ª—å–∫–æ—Ö —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä—ñ–≤:

**–Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏:**
- ‚úÖ URL –ø–∞—Ç—Ç–µ—Ä–Ω–∏ (`/thank-you`, `/order-confirmation` —Ç–æ—â–æ) - 3 –±–∞–ª–∏
- ‚úÖ –ù–∞—è–≤–Ω—ñ—Å—Ç—å Order ID –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ - 4 –±–∞–ª–∏
- ‚úÖ –ù–∞—è–≤–Ω—ñ—Å—Ç—å —Å—É–º–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è - 3 –±–∞–ª–∏
- ‚úÖ –¢–µ–∫—Å—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ ("Thank you", "Order confirmed" —Ç–æ—â–æ) - –¥–æ 4 –±–∞–ª—ñ–≤
- ‚úÖ DOM –µ–ª–µ–º–µ–Ω—Ç–∏ (—Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –∫–ª–∞—Å–∏/ID) - 2 –±–∞–ª–∏
- ‚úÖ Meta —Ç–µ–≥–∏ —Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ - 1 –±–∞–ª

**–ü–æ—Ä—ñ–≥:** –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –ø–æ—Ç—Ä—ñ–±–Ω–æ 5 –±–∞–ª—ñ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è.

**–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–µ–∑ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è:**

```html
<script>
  window.TRACKER_CONFIG = {
    BASE_URL: 'https://lehko.space/api/track',
    DEBUG: false,
    
    // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏—è–≤–ª–µ–Ω–Ω—è
    MIN_CONFIDENCE_SCORE: 5,  // –ü–æ—Ä—ñ–≥ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ (3-7 —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
                                // –ù–∏–∂—á–µ = –±—ñ–ª—å—à –∞–≥—Ä–µ—Å–∏–≤–Ω–æ (–º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø–æ–º–∏–ª–∫–∏)
                                // –í–∏—â–µ = –±—ñ–ª—å—à –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ (–º–æ–∂–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –¥–µ—è–∫—ñ)
    
    // –î–æ–¥–∞–π—Ç–µ —Å–≤–æ—ó URL –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏—è–≤–ª–µ–Ω–Ω—è (–±–µ–∑ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è!)
    CONVERSION_URLS: [
      '/success',           // –ü—Ä–æ—Å—Ç–∏–π —Ä—è–¥–æ–∫
      '/order-done',       // –Ü–Ω—à–∏–π URL
      /\/order\/\d+$/      // –ê–±–æ —Ä–µ–≥—É–ª—è—Ä–Ω–∏–π –≤–∏—Ä–∞–∑ –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö –≤–∏–ø–∞–¥–∫—ñ–≤
    ],
    
    // –î–æ–¥–∞–π—Ç–µ —Å–≤–æ—ó CSS —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ (–±–µ–∑ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è!)
    CONVERSION_SELECTORS: [
      '#my-success-page',      // ID –µ–ª–µ–º–µ–Ω—Ç–∞
      '.order-complete',       // –ö–ª–∞—Å –µ–ª–µ–º–µ–Ω—Ç–∞
      '[data-order-status="complete"]'  // –ê—Ç—Ä–∏–±—É—Ç
    ]
  };
</script>
```

**–ü—Ä–∏–∫–ª–∞–¥–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:**

1. **–Ø–∫—â–æ –≤–∞—à–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –º–∞—î —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π URL:**
```javascript
CONVERSION_URLS: ['/my-custom-success-page']
```

2. **–Ø–∫—â–æ –≤–∞—à–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –º–∞—î —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç:**
```javascript
CONVERSION_SELECTORS: ['#order-success-message']
```

3. **–Ø–∫—â–æ —Ç—Ä–µ–∫–µ—Ä –ø—Ä–æ–ø—É—Å–∫–∞—î –∫–æ–Ω–≤–µ—Ä—Å—ñ—ó (–∑–Ω–∏–∑–∏—Ç–∏ –ø–æ—Ä—ñ–≥):**
```javascript
MIN_CONFIDENCE_SCORE: 3  // –ë—ñ–ª—å—à –∞–≥—Ä–µ—Å–∏–≤–Ω–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è
```

4. **–Ø–∫—â–æ —Ç—Ä–µ–∫–µ—Ä —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –ø–æ–º–∏–ª–∫–æ–≤–æ (–ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø–æ—Ä—ñ–≥):**
```javascript
MIN_CONFIDENCE_SCORE: 7  // –ë—ñ–ª—å—à –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è
```

#### –†—É—á–Ω–µ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è (—è–∫—â–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –Ω–µ –ø—Ä–∞—Ü—é—î)

–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—ó –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ä—É—á–Ω–µ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:

```html
<script>
  // –ù–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
  window.AffiliateTracker.trackConversion(
    299.99,  // –°—É–º–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
    '12345'  // ID –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
  );
</script>
```

–ê–±–æ —á–µ—Ä–µ–∑ pixel (—è–∫—â–æ JavaScript –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π):

```html
<img src="https://lehko.space/api/track/conversion-pixel?order_value=299.99&order_id=12345" 
     width="1" height="1" style="display:none;">
```

---

## API

### `AffiliateTracker.trackView()`

–í—Ä—É—á–Ω—É –≤—ñ–¥—Å—Ç–µ–∂–∏—Ç–∏ –ø–µ—Ä–µ–≥–ª—è–¥ —Å—Ç–æ—Ä—ñ–Ω–∫–∏:

```javascript
window.AffiliateTracker.trackView();
```

### `AffiliateTracker.trackConversion(orderValue, orderId)`

–í—Ä—É—á–Ω—É –≤—ñ–¥—Å—Ç–µ–∂–∏—Ç–∏ –∫–æ–Ω–≤–µ—Ä—Å—ñ—é:

```javascript
window.AffiliateTracker.trackConversion(299.99, '12345');
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `orderValue` (number, –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) - –°—É–º–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
- `orderId` (string, –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) - ID –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç–∞–º

### `AffiliateTracker.getVisitorId()`

–û—Ç—Ä–∏–º–∞—Ç–∏ ID –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á–∞:

```javascript
const visitorId = window.AffiliateTracker.getVisitorId();
```

### `AffiliateTracker.getRefCode()`

–û—Ç—Ä–∏–º–∞—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∏–π –∫–æ–¥:

```javascript
const refCode = window.AffiliateTracker.getRefCode();
```

### `AffiliateTracker.setConfig(config)`

–û–Ω–æ–≤–∏—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:

```javascript
window.AffiliateTracker.setConfig({
  BASE_URL: 'https://new-domain.com/api/track',
  DEBUG: true
});
```

---

## –ì–æ—Ç–æ–≤—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

### –ü—Ä–∏–∫–ª–∞–¥ 1: –ë–∞–∑–æ–≤–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (–ø—Ä–∞—Ü—é—î –∑ –±—ñ–ª—å—à—ñ—Å—Ç—é —Å–∞–π—Ç—ñ–≤)

```html
<script>
  window.TRACKER_CONFIG = {
    BASE_URL: 'https://lehko.space/api/track',
    DEBUG: false
  };
</script>
<script src="https://lehko.space/tracker-v2.js" async></script>
```

### –ü—Ä–∏–∫–ª–∞–¥ 2: –ó –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º –¥–ª—è –≤–∞—à–æ–≥–æ —Å–∞–π—Ç—É

```html
<script>
  window.TRACKER_CONFIG = {
    BASE_URL: 'https://lehko.space/api/track',
    DEBUG: false,
    
    // –î–æ–¥–∞–π—Ç–µ URL –≤–∞—à–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
    CONVERSION_URLS: [
      '/order-success',        // –í–∞—à URL
      '/checkout/complete'     // –Ü–Ω—à–∏–π –º–æ–∂–ª–∏–≤–∏–π URL
    ],
    
    // –ê–±–æ –¥–æ–¥–∞–π—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä –µ–ª–µ–º–µ–Ω—Ç–∞ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
    CONVERSION_SELECTORS: [
      '#order-success-message'  // ID –∞–±–æ –∫–ª–∞—Å –µ–ª–µ–º–µ–Ω—Ç–∞
    ]
  };
</script>
<script src="https://lehko.space/tracker-v2.js" async></script>
```

### –ü—Ä–∏–∫–ª–∞–¥ 3: –î–ª—è WooCommerce

```html
<script>
  window.TRACKER_CONFIG = {
    BASE_URL: 'https://lehko.space/api/track',
    DEBUG: false,
    CONVERSION_URLS: ['/checkout/order-received'],
    CONVERSION_SELECTORS: ['.woocommerce-order']
  };
</script>
<script src="https://lehko.space/tracker-v2.js" async></script>
```

### –ü—Ä–∏–∫–ª–∞–¥ 4: –î–ª—è Shopify

```html
<script>
  window.TRACKER_CONFIG = {
    BASE_URL: 'https://lehko.space/api/track',
    DEBUG: false,
    CONVERSION_URLS: ['/checkout/thank-you', '/orders'],
    CONVERSION_SELECTORS: ['.order-status', '#order-status']
  };
</script>
<script src="https://lehko.space/tracker-v2.js" async></script>
```

### –ü—Ä–∏–∫–ª–∞–¥ 5: –ó –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–æ—é (–¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)

```html
<script>
  window.TRACKER_CONFIG = {
    BASE_URL: 'https://lehko.space/api/track',
    DEBUG: true,  // –£–≤—ñ–º–∫–Ω—É—Ç–∏ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É
    MIN_CONFIDENCE_SCORE: 3  // –ù–∏–∂—á–∏–π –ø–æ—Ä—ñ–≥ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
  };
</script>
<script src="https://lehko.space/tracker-v2.js" async></script>
```

---

## –ü—Ä–∏–∫–ª–∞–¥–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó

### WooCommerce

–î–æ–¥–∞–π—Ç–µ –≤ `functions.php`:

```php
add_action('woocommerce_thankyou', 'track_affiliate_conversion');
function track_affiliate_conversion($order_id) {
    $order = wc_get_order($order_id);
    $total = $order->get_total();
    ?>
    <script>
        if (window.AffiliateTracker) {
            window.AffiliateTracker.trackConversion(<?php echo $total; ?>, '<?php echo $order_id; ?>');
        }
    </script>
    <?php
}
```

### Shopify

–î–æ–¥–∞–π—Ç–µ –≤ `checkout.liquid` –∞–±–æ `order-status.liquid`:

```liquid
{% if order %}
<script>
  if (window.AffiliateTracker) {
    window.AffiliateTracker.trackConversion(
      {{ order.total_price | money_without_currency }},
      '{{ order.order_number }}'
    );
  }
</script>
{% endif %}
```

### Magento

–î–æ–¥–∞–π—Ç–µ –≤ `success.phtml`:

```php
<?php $order = $block->getOrder(); ?>
<script>
  if (window.AffiliateTracker && <?php echo $order->getId(); ?>) {
    window.AffiliateTracker.trackConversion(
      <?php echo $order->getGrandTotal(); ?>,
      '<?php echo $order->getIncrementId(); ?>'
    );
  }
</script>
```

### –ó–∞–≥–∞–ª—å–Ω–∏–π —Å–ø–æ—Å—ñ–± (–±—É–¥—å-—è–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)

–ù–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –¥–æ–¥–∞–π—Ç–µ:

```html
<script>
  // –û—Ç—Ä–∏–º–∞–π—Ç–µ —Å—É–º—É —Ç–∞ ID –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑ –≤–∞—à–æ—ó —Å–∏—Å—Ç–µ–º–∏
  const orderValue = 299.99; // –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—É —Å—É–º—É
  const orderId = '12345';    // –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π ID
  
  // –í—ñ–¥—Å—Ç–µ–∂—Ç–µ –∫–æ–Ω–≤–µ—Ä—Å—ñ—é
  if (window.AffiliateTracker) {
    window.AffiliateTracker.trackConversion(orderValue, orderId);
  }
</script>
```

---

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

```javascript
window.TRACKER_CONFIG = {
  BASE_URL: 'https://lehko.space/api/track',  // URL –≤–∞—à–æ–≥–æ API
  DEBUG: false,                                // –£–≤—ñ–º–∫–Ω—É—Ç–∏ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É
  COOKIE_DOMAIN: '.example.com',               // –î–æ–º–µ–Ω –¥–ª—è cookies (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
  
  // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏—è–≤–ª–µ–Ω–Ω—è –∫–æ–Ω–≤–µ—Ä—Å—ñ–π
  MIN_CONFIDENCE_SCORE: 5,                     // –ü–æ—Ä—ñ–≥ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ (3-7)
  CONVERSION_URLS: [],                         // –í–∞—à—ñ URL –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è
  CONVERSION_SELECTORS: []                     // –í–∞—à—ñ CSS —Å–µ–ª–µ–∫—Ç–æ—Ä–∏
};
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó:**

- `BASE_URL` (–æ–±–æ–≤'—è–∑–∫–æ–≤–æ) - URL –≤–∞—à–æ–≥–æ API
- `DEBUG` (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) - –£–≤—ñ–º–∫–Ω—É—Ç–∏ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É (true/false)
- `COOKIE_DOMAIN` (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) - –î–æ–º–µ–Ω –¥–ª—è cookies (–¥–ª—è –ø—ñ–¥–¥–æ–º–µ–Ω—ñ–≤)
- `MIN_CONFIDENCE_SCORE` (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) - –ü–æ—Ä—ñ–≥ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏—è–≤–ª–µ–Ω–Ω—è (3-7, –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 5)
- `CONVERSION_URLS` (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) - –ú–∞—Å–∏–≤ URL –∞–±–æ —Ä–µ–≥—É–ª—è—Ä–Ω–∏—Ö –≤–∏—Ä–∞–∑—ñ–≤ –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –∫–æ–Ω–≤–µ—Ä—Å—ñ–π
- `CONVERSION_SELECTORS` (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) - –ú–∞—Å–∏–≤ CSS —Å–µ–ª–µ–∫—Ç–æ—Ä—ñ–≤ –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –∫–æ–Ω–≤–µ—Ä—Å—ñ–π

### DEBUG —Ä–µ–∂–∏–º

–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å `DEBUG: true` –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

```javascript
window.TRACKER_CONFIG = {
  BASE_URL: 'https://lehko.space/api/track',
  DEBUG: true
};
```

–£ –∫–æ–Ω—Å–æ–ª—ñ –±—Ä–∞—É–∑–µ—Ä–∞ –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ:
- `[Affiliate Tracker v2] Ref code stored: ABC123`
- `[Affiliate Tracker v2] Page view tracked`
- `[Affiliate Tracker v2] Conversion tracked (POST): {...}`

---

## –ú—ñ–≥—Ä–∞—Ü—ñ—è –∑ v1 –Ω–∞ v2

### –©–æ –∑–º—ñ–Ω–∏–ª–æ—Å—è:

1. **–§–∞–π–ª:** `tracker.js` ‚Üí `tracker-v2.js`
2. **API:** –ü—Ä–∞–∫—Ç–∏—á–Ω–æ —ñ–¥–µ–Ω—Ç–∏—á–Ω–∏–π, –∞–ª–µ —Å–ø—Ä–æ—â–µ–Ω–∏–π
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è:** –ú–µ–Ω—à–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏, –±—ñ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—é

### –ö—Ä–æ–∫–∏ –º—ñ–≥—Ä–∞—Ü—ñ—ó:

1. –ó–∞–º—ñ–Ω—ñ—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å–∫—Ä–∏–ø—Ç:
   ```html
   <!-- –°—Ç–∞—Ä–µ -->
   <script src="https://lehko.space/tracker.js"></script>
   
   <!-- –ù–æ–≤–µ -->
   <script src="https://lehko.space/tracker-v2.js"></script>
   ```

2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä—É—á–Ω–µ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∫–æ–Ω–≤–µ—Ä—Å—ñ–π (—è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ)

3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä–æ–±–æ—Ç—É –≤ DEBUG —Ä–µ–∂–∏–º—ñ

---

## –£—Å—É–Ω–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–Ω–≤–µ—Ä—Å—ñ—ó –Ω–µ –≤—ñ–¥—Å—Ç–µ–∂—É—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

**–†—ñ—à–µ–Ω–Ω—è:**
1. –£–≤—ñ–º–∫–Ω—ñ—Ç—å DEBUG —Ä–µ–∂–∏–º (`DEBUG: true`)
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ - –ø–æ–±–∞—á–∏—Ç–µ —Å–∫—ñ–ª—å–∫–∏ –±–∞–ª—ñ–≤ –Ω–∞–±—Ä–∞–Ω–æ
3. –î–æ–¥–∞–π—Ç–µ –≤–∞—à—ñ URL –∞–±–æ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é:
   ```javascript
   CONVERSION_URLS: ['/your-success-page'],
   CONVERSION_SELECTORS: ['#your-success-element']
   ```
4. –ó–Ω–∏–∑—å—Ç–µ –ø–æ—Ä—ñ–≥ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ:
   ```javascript
   MIN_CONFIDENCE_SCORE: 3
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –¢—Ä–µ–∫–µ—Ä —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö —Å—Ç–æ—Ä—ñ–Ω–∫–∞—Ö

**–†—ñ—à–µ–Ω–Ω—è:**
1. –ü—ñ–¥–≤–∏—â—Ç–µ –ø–æ—Ä—ñ–≥ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ:
   ```javascript
   MIN_CONFIDENCE_SCORE: 7
   ```
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ DEBUG —Ä–µ–∂–∏–º - —è–∫—ñ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏ —Å–ø—Ä–∞—Ü—å–æ–≤—É—é—Ç—å
3. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –±—ñ–ª—å—à —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ URL/—Å–µ–ª–µ–∫—Ç–æ—Ä–∏

### –ü—Ä–æ–±–ª–µ–º–∞: Cookies –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è

**–†—ñ—à–µ–Ω–Ω—è:**
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è SameSite cookies
2. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è HTTPS
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è COOKIE_DOMAIN

### –ü—Ä–æ–±–ª–µ–º–∞: CORS –ø–æ–º–∏–ª–∫–∏

**–†—ñ—à–µ–Ω–Ω—è:**
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è CORS –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ
2. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ BASE_URL –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ —Å–µ—Ä–≤–µ—Ä –¥–æ–∑–≤–æ–ª—è—î –∑–∞–ø–∏—Ç–∏ –∑ –≤–∞—à–æ–≥–æ –¥–æ–º–µ–Ω—É

---

## –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è v1 vs v2

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | v1 | v2 |
|----------------|----|----|
| –†–æ–∑–º—ñ—Ä –∫–æ–¥—É | 1500 —Ä—è–¥–∫—ñ–≤ | 600 —Ä—è–¥–∫—ñ–≤ |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è | –°–∫–ª–∞–¥–Ω–µ, –Ω–µ–Ω–∞–¥—ñ–π–Ω–µ | –†–æ–∑—É–º–Ω–µ, –Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞–Ω–µ |
| –°–∏—Å—Ç–µ–º–∞ –æ—á–æ–∫ | –ù–µ–º–∞—î | –Ñ (6 —Ç–∏–ø—ñ–≤ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä—ñ–≤) |
| –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–µ–∑ –∫–æ–¥—É | –ù–µ–º–∞—î | –Ñ (URL + —Å–µ–ª–µ–∫—Ç–æ—Ä–∏) |
| –ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å | –°–µ—Ä–µ–¥–Ω—è | –í–∏—Å–æ–∫–∞ |
| –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ | –°–∫–ª–∞–¥–Ω–∞ | –ü—Ä–æ—Å—Ç–∞ |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è | –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ | –ü–æ–≤–Ω–∞ |

---

## –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–Ø–∫—â–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å –ø—Ä–æ–±–ª–µ–º–∏:

1. –£–≤—ñ–º–∫–Ω—ñ—Ç—å DEBUG —Ä–µ–∂–∏–º
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ Network –≤–∫–ª–∞–¥–∫—É –≤ DevTools
4. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ä—É—á–Ω–µ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Å—ñ–π

---

## –û–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ

–ü—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª—É:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä—ñ
cd /home/ergoa/affiliate-tracking
pm2 restart affiliate-tracking-api
```

–§–∞–π–ª `tracker-v2.js` –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑–∞ –∞–¥—Ä–µ—Å–æ—é:
```
https://lehko.space/tracker-v2.js
```
